<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ - Wassal Khedma</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f7f9;
    }

    nav {
      background-color: #2c3e50;
      color: white;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    nav img {
      height: 45px;
    }

    nav .links a {
      color: white;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
    }

    nav .links a:hover {
      color: #1abc9c;
    }

    nav .notifications {
      position: relative;
      cursor: pointer;
      font-size: 20px;
    }

    nav .notifications span {
      position: absolute;
      top: -8px;
      right: -8px;
      background: red;
      color: white;
      font-size: 12px;
      padding: 3px 6px;
      border-radius: 50%;
    }

    .dashboard {
      padding: 40px 20px;
      max-width: 1200px;
      margin: auto;
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }

    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .card {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .card h2 {
      margin: 0;
      color: #3498db;
      font-size: 36px;
    }

    .card p {
      margin-top: 10px;
      font-size: 18px;
      color: #555;
    }

    .profile {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-top: 40px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    #map {
      height: 400px;
      width: 100%;
      margin-top: 40px;
      border-radius: 10px;
    }

    /* Ø²Ø± ÙØªØ­ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† */
    .admin-dashboard-link {
      display: none; /* ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù† */
      width: max-content;
      margin: 30px auto 0;
      background-color: #2980b9;
      color: white;
      font-weight: bold;
      padding: 10px 15px;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      text-align: center;
      cursor: pointer;
    }

    .admin-dashboard-link:hover {
      background-color: #1abc9c;
    }

    .footer {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 50px;
      user-select: none;
    }
  </style>
</head>
<body>

  <!-- Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© -->
  <script>
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¯ÙˆØ± Ù…Ù† localStorage Ù…Ø¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø­Ø±ÙˆÙ Ø§Ù„ØµØºÙŠØ±Ø©
    let roleRaw = localStorage.getItem("role") || "";
    const role = roleRaw.trim().toLowerCase();

    // Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ù„Ù„Ø¹Ù…Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„
    if (role !== "worker" && role !== "admin") {
      alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.");
      window.location.href = "login.html";
    }
  </script>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
  <nav>
    <div class="logo">
      <img src="images/wassal.jfif" alt="Wassal Khedma" />
    </div>
    <div class="links" id="navLinks">
      <!-- Ø³ÙŠØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
    </div>
    <div class="notifications" onclick="showNotifications()" aria-label="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª">
      ğŸ”” <span id="notifCount" aria-live="polite" aria-atomic="true">0</span>
    </div>
  </nav>

  <div class="dashboard">
    <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ù„ - Wassal Khedma</h1>

    <div class="cards" id="cardsContainer">
      <div class="card">
        <h2 id="requestCount">0</h2>
        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
      </div>
      <div class="card">
        <h2 id="completedCount">0</h2>
        <p>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
      </div>
    </div>

    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„ -->
    <div class="profile" id="workerProfile">
      <h3>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
      <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="workerName">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
      <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</strong> <span id="workerEmail">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
      <p><strong>Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> <span id="workerService">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
      <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> <span id="workerLocation">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></p>
    </div>

    <!-- Ø²Ø± Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø£Ø¯Ù…Ù† -->
    <a href="dashboard.html" id="adminDashboardBtn" class="admin-dashboard-link">
      ÙØªØ­ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†
    </a>

    <h2 style="margin-top: 50px; color: #2c3e50;">Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
    <div id="map"></div>
  </div>

  <div class="footer">
    &copy; 2025 Wassal Khedma - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©
  </div>

  <script>
    // Ø¨Ù†Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± (Ø¹Ø§Ù…Ù„ Ø£Ùˆ Ø£Ø¯Ù…Ù†)
    const navLinks = document.getElementById("navLinks");

    function buildNavLinks() {
      let linksHTML = '';

      if (role === "admin") {
        // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø¯Ù…Ù† ÙƒØ§Ù…Ù„Ø©
        linksHTML = `
          <a href="dashboard.html">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          <a href="workers.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</a>
          <a href="clients.html">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a>
          <a href="requests.html">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
          <a href="payments.html">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</a>
          <a href="#" id="logoutLink">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        `;

        // Ù†Ø¸Ù‡Ø± Ø²Ø± Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†
        document.getElementById("adminDashboardBtn").style.display = "block";

        // Ù†Ø¸Ù‡Ø± Ø¨Ø·Ø§Ù‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£Ø¯Ù…Ù† (Ù…Ø«Ø§Ù„)
        document.getElementById("cardsContainer").innerHTML = `
          <div class="card">
            <h2 id="workerCount">0</h2>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„</p>
          </div>
          <div class="card">
            <h2 id="clientCount">0</h2>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
          </div>
          <div class="card">
            <h2 id="requestCount">0</h2>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
          </div>
          <div class="card">
            <h2 id="paymentCount">0</h2>
            <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</p>
          </div>
        `;
      } else if (role === "worker") {
        // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…Ù„ ÙÙ‚Ø·
        linksHTML = `
          <a href="worker_dashboard.html">Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ù„</a>
          <a href="my_requests.html">Ø·Ù„Ø¨Ø§ØªÙŠ</a>
          <a href="workers.html">ÙƒÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„</a>
          <a href="#" id="logoutLink">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
        `;
      }

      navLinks.innerHTML = linksHTML;
    }

    buildNavLinks();

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù…Ø³Ø­ localStorage ÙˆØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.addEventListener("click", e => {
      if (e.target.id === "logoutLink") {
        e.preventDefault();
        localStorage.clear();  // Ù‡Ù†Ø§ ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù„Ùˆ ØªÙØ¶Ù„ ÙÙ‚Ø· Ù…Ø³Ø­ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ø¯Ù„ Ù‡Ù†Ø§
        alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­");
        window.location.href = "login.html";
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„ Ù…Ù† LocalStorage (Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ùˆ ØªØ­Ø¨)
    const currentWorkerId = localStorage.getItem("current_worker_id");
    const workersList = JSON.parse(localStorage.getItem("workers")) || [];
    const workerData = workersList.find(w => w.id == currentWorkerId) || {};

    document.getElementById("workerName").innerText = workerData.name || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("workerEmail").innerText = workerData.email || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("workerService").innerText = workerData.service || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
    document.getElementById("workerLocation").innerText = workerData.location || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    let newRequests = JSON.parse(localStorage.getItem("new_requests")) || [];
    let completedRequests = JSON.parse(localStorage.getItem("completed_requests")) || [];

    if (role === "worker") {
      // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„ ÙÙ‚Ø·
      newRequests = newRequests.filter(r => r.workerId == currentWorkerId);
      completedRequests = completedRequests.filter(r => r.workerId == currentWorkerId);
    }

    document.getElementById("requestCount").innerText = newRequests.length;
    document.getElementById("completedCount").innerText = completedRequests.length;
    document.getElementById("notifCount").innerText = newRequests.length;

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø£Ø¯Ù…Ù† (Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ø§Ù„ØŒ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª)
    if (role === "admin") {
      const users = JSON.parse(localStorage.getItem("wassal_users")) || [];
      const payments = JSON.parse(localStorage.getItem("wassal_payments")) || [];

      document.getElementById("workerCount").innerText = users.filter(u => u.role === "worker").length;
      document.getElementById("clientCount").innerText = users.filter(u => u.role === "client").length;
      document.getElementById("requestCount").innerText = newRequests.length + completedRequests.length;
      document.getElementById("paymentCount").innerText = payments.length;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotifications() {
      if (newRequests.length > 0) {
        alert("ğŸ“¢ Ù„Ø¯ÙŠÙƒ " + newRequests.length + " Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.");
      } else {
        alert("âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.");
      }
    }

    // Google Map - Ø¹Ø±Ø¶ Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    function initMap() {
      const egyptCenter = { lat: 30.0444, lng: 31.2357 };
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 6,
        center: egyptCenter,
      });

      newRequests.forEach(req => {
        if (req.lat && req.lng) {
          new google.maps.Marker({
            position: { lat: req.lat, lng: req.lng },
            map,
            title: `Ø·Ù„Ø¨ Ù…Ù† ${req.clientName || 'Ø¹Ù…ÙŠÙ„'}`,
          });
        }
      });
    }
  </script>

  <!-- Ø§Ø³ØªØ¨Ø¯Ù„ YOUR_API_KEY Ø¨Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø®Ø§Øµ -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
  </script>

</body>
</html>
